<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Galen-Yip's blog,前端开发,设计,前端开发工程师">
    <link rel="shortcut icon" href="http://7xnand.com1.z0.glb.clouddn.com/avatar.png">

    <title>Web Component - Galen's Blog</title>

    <link rel="canonical" href="http://galen-yip.com/2015/03/15/web-component/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="http://7xnand.com1.z0.glb.clouddn.com/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="http://7xnand.com1.z0.glb.clouddn.com/my-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="http://7xnand.com1.z0.glb.clouddn.com/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.useso.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?38726958ceae2be17f47715028a943f9";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Galen's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about/">About</a>
                </li>
                
                <li>
                    <a href="/contact/">Contact</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('http://7xnand.com1.z0.glb.clouddn.com/img/post-bg-02.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Web Component</h1>
                    
                    <h2 class="subheading">面向未来</h2>
                    
                    <span class="meta">Posted by Galen on March 15, 2015</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<blockquote>
  <p>授人以鱼不如授人以渔</p>
</blockquote>

<p>如果把组件比作鱼，那么w3c组织定制的标准和浏览器厂商的实现都是鱼，并没有赋予开发者们真正的渔。
开发者们在现有的技术和条件下，用五花八门的方法创造了各种组件。但是却严重缺乏规范。
  而Web Component则在组件标准化方面贡献了重大的力量。当然，Web Component 只是规范了接口，底层实现是完全自由的。</p>

<p>Web Component目前只是作为草案，还没有完全的标准化。API可在变动中。但我们可以先来学习一下</p>

<p>先来说说浏览器的支持情况先，免得看官觉得不规范的东西没有必要学习了
Chrome 27和Firfox23都提供了对<code>document.registerElement（）</code>的支持。
Chrome 31是第一个真正支持新规范的版本
在浏览器支持稳定的版本之前：</p>

<ul>
  <li>Google的Polymer的兼容方案</li>
  <li>Mozilla的x-tags</li>
</ul>

<p>Web Component不是Web 组件，确切说应该是web组件标准化。Web Component使开发人员拥有扩展浏览器标签的能力，可以自由定制组件。</p>

<hr />

<h3 id="web">Web组件</h3>

<p>Web组件就是一套封装好的HTML、CSS、Js。</p>

<p>特点：<strong>可复用</strong></p>

<p>例子：下拉菜单、按钮、图片轮播、日历控件</p>

<p>对比Web 组件，Web Component有什么用呢？</p>

<p>首先，组件内部是可以被访问和影响的。而通过Web Component封装出来的组件，可以选择让组件内部隐藏起来。</p>

<hr />

<blockquote>
  <h3 id="web-component">Web Component</h3>
</blockquote>

<h4 id="section">组成：</h4>
<ul>
  <li>Custom  Elements( 核心 )</li>
  <li>HTML Templates</li>
  <li>Shadow Dom</li>
  <li>HTML Imports</li>
</ul>

<hr />

<blockquote>
  <h4 id="custom-elements">Custom Elements</h4>
</blockquote>

<p>自定义元素。通过<code>document.registerElement( )</code>对自定义元素进行注册。该方法返回一个元素的构造器。通过构造器，我们可以创建自定义元素的实例了</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">MyButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="err">‘</span><span class="nx">my</span><span class="o">-</span><span class="nx">button</span><span class="err">’</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyButton</span><span class="p">());</span></code></pre></div>

<p><code>document.registerElement（tagName, [prototype]）</code>   是接受2个参数的。
第二个可选</p>

<ul>
  <li>tagName. 必须包含连字符“-”。这是为了区分自定义元素和HTML规范的元素</li>
  <li>prototype.可选。用来描述元素的原型。为元素自定义接口</li>
</ul>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">MyElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="s1">&#39;my-element&#39;</span><span class="p">,</span> <span class="p">{</span> 
      <span class="nx">prototype</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span> 
          <span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span> 
              <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
                  <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;I&#39;m a Custom Element&lt;/p&gt;&quot;</span>
              <span class="p">}</span> 
          <span class="p">}</span> 
      <span class="p">})</span> 
  <span class="p">});</span>


  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyElement</span><span class="p">());</span></code></pre></div>

<p>其中,<code>Object.create() </code>是创建一个继承自 <code>HTMLElement</code>原型的对象 作为自定义对象的原型。
并且设置元素默认的innerHTML</p>

<p>下面的写法跟上面是同一个效果</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">MyElementProto</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span>

  <span class="nx">MyElementProto</span><span class="p">.</span><span class="nx">createdCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;I&#39;m a Custom Element&lt;/p&gt;&quot;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">MyElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="s1">&#39;my-element&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">prototype</span><span class="o">:</span> <span class="nx">MyElementProto</span> <span class="p">})</span>

  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyElement</span><span class="p">())</span></code></pre></div>

<hr />

<blockquote>
  <h4 id="section-1">对元素的拓展</h4>
</blockquote>

<p>比如要拓展Button元素</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">MyButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="err">‘</span><span class="nx">my</span><span class="o">-</span><span class="nx">button</span><span class="err">’</span><span class="p">,</span> <span class="p">{</span>
       <span class="nx">prototype</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLButtonElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span>
  <span class="p">})</span></code></pre></div>

<p>这类的自定义元素被称为类型扩展自定义元素
使用：
<code>&lt;button is=“my-button”&gt;</code></p>

<hr />

<blockquote>
  <h4 id="section-2">元素的提升</h4>
</blockquote>

<p>首先，浏览器中的HTML解析器对非标准标签并不会报错，这是为什么呢？
比如我们申明了一个<code>&lt;qwe&gt;</code>标签，一切都很正常，并不会出现报错的情况。
根据HTML规范，非标准的元素使用的是<code>HTMLUnKnownElement</code> 接口</p>

<p>但是对于自定义标签（即有连接符的标签）就不一样了，它是拥有合法元素名的，所以是继承自<code>HTMLElement</code>的</p>

<p>下面这段代码就给出了答案，两者都是输出true</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// “tabs”不是一个合法的自定义元素名</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;tabs&#39;</span><span class="p">).</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nx">HTMLUnknownElement</span><span class="p">.</span><span class="nx">prototype</span>
   
  <span class="c1">// “x-tabs”是一个合法的自定义元素名</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;x-tabs&#39;</span><span class="p">).</span><span class="nx">__proto__</span> <span class="o">==</span> <span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span></code></pre></div>

<p>注意：在不支持<code>document.registerElement（）</code>的浏览器，自定义标签是继承自<code>HTMLUnknownElement</code>的</p>

<p>那什么是元素的提升？？？
比如我们现在HTML中声明了<code>&lt;x-tabs&gt;标签，然后再调用</code>document.registerElement（’x-tabs’）`</p>

<p>在声明了元素，但在注册元素之前，我们就称该元素是<code>Unresolved</code>元素。他们拥有合法的元素名，只是还没有注册。</p>

<p><code>Unresolved</code>元素可以理解为一个中间态的状态，在等待浏览器提升为一个新元素</p>

<hr />

<blockquote>
  <h4 id="section-3">实例化元素</h4>
</blockquote>

<p>自定义元素可以在HTML中声明，也可以在JS中创建。跟正常的标签是一样的。</p>

<p>实例化自定义标签
HTML中：
<code>&lt;x-tabs&gt;&lt;/x-tabs&gt;</code></p>

<p>js中：
<code>var xtabs = document.createElement(‘x-tabs')</code></p>

<p>使用new 构造器</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">xtabs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Xtabs</span><span class="p">()</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">xtabs</span><span class="p">)</span></code></pre></div>

<p>实例化类型扩展元素
HTML中：
<code>&lt;button is=“my-button”&gt;</code></p>

<p>js中：
<code>var button = document.createElement(‘button’, ‘my-button’)</code></p>

<p>添加属性和方法
<code>var XFooProto = Object.create(HTMLElement.prototype);</code></p>

<p>// 1. 为 x-foo 创建 foo() 方法</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">XFooProto</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;foo() called&#39;</span><span class="p">);</span>
  <span class="p">};</span></code></pre></div>

<p>// 2. 定义一个只读的“bar”属性
<code>Object.defineProperty(XFooProto, "bar", {value: 5});</code></p>

<p>// 3. 注册 x-foo 的定义
<code>var XFoo = document.registerElement('x-foo', {prototype: XFooProto});</code></p>

<p>// 4. 创建一个 x-foo 实例
<code>var xfoo = document.createElement('x-foo');</code></p>

<p>// 5. 插入页面
<code>document.body.appendChild(xfoo);</code></p>

<p>当然最后面的4、5可以用new构造器来创建
如果不喜欢这种构造prototype的方法，也可以像下面这样写</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">XFoo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="s1">&#39;x-foo&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">prototype</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">bar</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">5</span><span class="p">;</span> <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">foo</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;foo() called&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">});</span></code></pre></div>

<p>第一种是直接使用了ES5的<code>Object.defineProperty</code>
第二种使用了<code>get/set</code></p>

<hr />

<blockquote>
  <h4 id="section-4">生命周期回调方法</h4>
  <p>createdCallback属性，值是一个回调函数，在自定义元素被创建时被调用</p>
</blockquote>

<p>不同的时期，都有不同的回调函数。
这些回调函数保存在一个叫做 生命周期回调 的键值对集合中。</p>

<p><img src="../../../../img/post-02-zhouqi.jpg" alt="生命周期" /></p>

<p>createdCallback、attachCallback、detachedCallback、attributeChangeCallback</p>

<p>DOM:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;modify&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">label</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;CEgreen&quot;</span><span class="o">&gt;&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;CEclass&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="o">&gt;</span><span class="nx">green</span> <span class="nx">box</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
    <span class="o">&lt;</span><span class="nx">label</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;CEred&quot;</span><span class="o">&gt;&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;CEclass&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="o">&gt;</span><span class="nx">red</span> <span class="nx">box</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span></code></pre></div>

<p>JS:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">MyElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="s1">&#39;my-element&#39;</span><span class="p">,</span> <span class="p">{</span> 
    <span class="nx">prototype</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span> 
      <span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span> 
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&lt;span&gt;I&#39;m a Custom Element&lt;/span&gt;&quot;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">attributeChangedCallback</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;attribute &#39;&quot;</span> <span class="o">+</span> <span class="nx">property</span> <span class="o">+</span> <span class="s2">&quot;&#39; is modified to &quot;</span> <span class="o">+</span> <span class="nx">newValue</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span> 
  <span class="p">})</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyElement</span><span class="p">())</span>

  <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#modify&quot;</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">myElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;my-element&quot;</span><span class="p">)</span>

  <span class="nx">temp</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="nx">myElement</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
  <span class="p">})</span></code></pre></div>

<p>另外，给自定义元素添加样式和普通元素是一样的，这是上面例子中为自定义元素添加的样式：</p>

<p><code>my-element {display: inline-block;margin-top: 20px;padding: 10px;font-size: 24px;}</code></p>

<p>如果希望元素内部不受外部样式影响，需要使用Shadow Dom对内部的dom结构和样式进行封装</p>

<hr />

<blockquote>
  <h4 id="shadow-dom">Shadow Dom封装内部</h4>
</blockquote>

<p>Shadow Dom能干什么？
他能为自定义元素提供：</p>

<ul>
  <li>隐藏内部’龌蹉’的实现，做统一接口</li>
  <li>样式隔离</li>
</ul>

<p>从Shadow Dom创建元素的区别是createdCallback回调</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">XFooProto</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>

  <span class="nx">XFooProto</span><span class="p">.</span><span class="nx">createdCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 1. 为元素附加一个 shadow root。</span>
  <span class="kd">var</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>

  <span class="c1">// 2. 填入标记。</span>
  <span class="nx">shadow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;I&#39;m in the element&#39;s Shadow DOM!&lt;/b&gt;&quot;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">XFoo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="s1">&#39;x-foo-shadowdom&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">prototype</span><span class="o">:</span> <span class="nx">XFooProto</span><span class="p">});</span></code></pre></div>

<p>这里我们不是直接为自定义元素设置<code>innerHTML</code>
而是在ShadowRoot上设置，在DevTools中勾选’Show Shadow Dom’ ，就会看到一个展开的# Shadow Root</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;x-foo-shadowdom&gt;</span>
  #shadow-root
  <span class="nt">&lt;b&gt;</span>I&#39;m in the element&#39;s Shadow DOM!<span class="nt">&lt;/b&gt;</span>
  <span class="nt">&lt;/x-foo-shadowdom&gt;</span></code></pre></div>

<p>添加样式
有了Shadow Dom ，样式的封装就不会影响到宿主外部
而自定义元素其实就是宿主
那么样式封装就可以为自定义元素定义默认样式</p>

<p>首先，因为存在unresolved状态，所以，就会存在FOUC的现象。FOUC是无样式内容闪烁（flash of unstyled content）。
可以详见<a href="http://blog.csdn.net/kongtoubudui/article/details/129754010">a</a></p>

<p>为了缓解这种情况，自定义元素就定义了一个新的伪类 <code>:unresolved</code>
在调用createCallback之前，这个伪类能够匹配到unresolved元素。
完成元素提升的时候，这个匹配就失效，也就完成了它的任务
这个元素也就不是unresolved元素</p>

<p>注：chrome29就已经原声支持css :unresolved伪类了</p>

<p>用法：</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">x-foo</span> <span class="p">{</span>
  <span class="k">opacity</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
  <span class="n">transition</span><span class="o">:</span> <span class="k">opacity</span> <span class="m">300</span><span class="n">ms</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">x-foo</span><span class="nd">:unresolved</span> <span class="p">{</span>
  <span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="p">}</span></code></pre></div>

<hr />

<blockquote>
  <h4 id="html">HTML模板中创建元素</h4>
</blockquote>

<p>HTML模板是一组跟自定义元素完全融合的新的API</p>

<p><code>&lt;template&gt;</code>元素用于声明DOM片段。可以在dom解析和页面加载完之后插入，以及延迟到运行时才实例化。
可以说，模板是声明自定义元素结构的理想方案。</p>

<p>下面是<code>&lt;template&gt;</code>和Shadow Dom结合的例子</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">&quot;sdtemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
    <span class="nt">p</span> <span class="p">{</span> <span class="k">color</span><span class="o">:</span> <span class="nb">orange</span><span class="p">;</span> <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;p&gt;</span>I&#39;m in Shadow DOM. My markup was stamped from a <span class="ni">&amp;lt;</span>template<span class="ni">&amp;gt;</span>.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/template&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">proto</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#sdtemplate&#39;</span><span class="p">);</span>
          <span class="kd">var</span> <span class="nx">clone</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">importNode</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">().</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">clone</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">registerElement</span><span class="p">(</span><span class="s1">&#39;x-foo-from-template&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">prototype</span><span class="o">:</span> <span class="nx">proto</span><span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span></code></pre></div>

<p>以上的流程大体如下：</p>

<ul>
  <li>创建一个自定义元素</li>
  <li>自定义元素的原型中，把template的内容写入Shadow Dom中</li>
  <li>Shadow Dom对样式进行了隔离，即里面的样式不让让全局的p都变成橙色</li>
</ul>

<hr />

<blockquote>
  <h4 id="section-5">话外</h4>
</blockquote>

<p>曾经有一个<code>&lt;element&gt;</code>标签，不知道看官们知道不。他十分好用，直接像下面这样就可以注册一个新元素了</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;my-element&quot;</span><span class="nt">&gt;</span>
  //...
  <span class="nt">&lt;/element&gt;</span></code></pre></div>

<p>然而据说他是因为在提升过程、边界案例、以及各种复杂场景中，需要处理大量的时序问题。最后在2013年8月Dimitri Glazkov在public-webapps 邮件组中宣告移除 <code>&lt;element&gt;</code></p>

<p>前文提到的Polymer方案中，实现了<code>&lt;polymer-element&gt;</code>的形式声明的注册元素。
他利用的正是<code>document.registerElement(‘polymer-element’)</code>以及模板技术</p>

<blockquote>
  <h4 id="section-6">总结</h4>
</blockquote>

<p>自定义元素结合Shadow Dom和template让我们看到了Web Component的未来。
但目前其实浏览器对Web Component的支持还是有限的，毕竟标准还没有下来。
现在更多的仍是web组件的形式。
但这项技术的未来仍然是光明的。Google的Polymer提供了我们需要的一些</p>

<blockquote>
  <h4 id="section-7">推荐阅读</h4>
  <p><a href="http://mobile.51cto.com/web-395159.htm">web组件才是web开发的未来？</a></p>
</blockquote>



                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2015/02/28/new-year-submit/" data-toggle="tooltip" data-placement="top" title="开年第一篇——步履不停">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2015/10/07/%E3%80%90%E8%AF%91%E3%80%91%E4%BD%BF%E7%94%A8requestIdleCallback/" data-toggle="tooltip" data-placement="top" title="【译】使用requestIdleCallback">Next Post &rarr;</a>
                    </li>
                    
                </ul>
                

                <hr>

                <!-- 多说评论框 start -->
                    <div class="ds-thread comment-wrap" data-thread-key=/2015/03/15/web-component data-title=Web Component data-url="galen-yip.com/2015/03/15/web-component/"></div>
                <!-- 多说评论框 end -->
                <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
                <script type="text/javascript">
                var duoshuoQuery = {short_name:"galen-yip"};
                    (function() {
                        var ds = document.createElement('script');
                        ds.type = 'text/javascript';ds.async = true;
                        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                        ds.charset = 'UTF-8';
                        (document.getElementsByTagName('head')[0] 
                         || document.getElementsByTagName('body')[0]).appendChild(ds);
                    })();
                </script>
                <!-- 多说公共JS代码 end -->

            </div>
        </div>
    </div>
</article>





    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/Galen-Yip">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; <a href="http://weibo.com/yexiaosi">Galen-Yip</a> 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="http://7xnand.com1.z0.glb.clouddn.com/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="http://7xnand.com1.z0.glb.clouddn.com/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="http://7xnand.com1.z0.glb.clouddn.com/my-blog.min.js "></script>


</body>

</html>
